# 学校成绩管理系统 (SMS)
> School Management System - 产品需求文档 (PRD)

## 📋 项目概览

### 1.1 产品定位
学校成绩管理系统是一个面向中小学的综合性学生管理平台，以学生为中心整合学籍管理、考试管理、成绩录入与分析等核心教务功能。系统采用现代化的Web技术栈，提供学生全生命周期的一体化管理体验，支持多角色用户访问，提供直观的数据可视化和强大的数据分析能力。

### 1.2 技术架构
- **后端**: Django 5.2.4 + Python 3.12+
- **前端**: Next.js 15.4.6 + React 19 + TypeScript + Tailwind CSS
- **数据库**: SQLite (开发环境) / PostgreSQL (生产环境)
- **异步任务**: Redis + django-rq
- **部署**: 支持 Docker 容器化部署

### 1.3 核心价值
- 📊 **以学生为中心**: 提供学生全生命周期的一体化管理体验
- 🎯 **数据驱动决策**: 全方位的学业表现统计分析和可视化报表
- 🚀 **高效教务管理**: 支持批量操作，大幅提升教务管理效率
- 🔒 **安全可靠**: 完善的权限控制和数据安全保障
- 📱 **响应式设计**: 支持PC、平板、手机多端访问

---

## 🏗️ 系统架构

### 2.1 技术栈详情
```
Frontend Layer (前端层)
├── Next.js 15.4.6 (App Router)
├── React 19 + TypeScript
├── Tailwind CSS + Radix UI
└── 响应式UI组件库

Backend Layer (后端层)
├── Django 5.2.4 (Python 3.12+)
├── Django REST Framework (API)
├── django-rq (异步任务处理)
└── 权限认证系统

Data Layer (数据层)
├── SQLite/PostgreSQL (主数据库)
├── Redis (缓存 + 任务队列)
└── 数据迁移和备份系统

Infrastructure (基础设施)
├── Docker 容器化
├── Nginx 反向代理
└── 日志监控系统
```

### 2.2 项目结构
```
SMS/
├── school_management/           # Django 后端应用
│   ├── students_grades/         # 统一学生/考试/成绩模块（原 students + exams 已合并）
│   │   ├── models/              # 数据模型（Student, Exam, Score 等）
│   │   ├── views/               # 视图/分析逻辑（成绩分析、排名计算等）
│   │   ├── urls.py              # 应用路由
│   │   └── admin.py             # 后台管理配置
│   └── settings.py              # 系统配置
├── frontend/                    # Next.js 前端应用
├── templates/                   # Django 模板
├── scripts/                     # 运维脚本（已更新为引用 students_grades）
├── data/                        # 数据文件和模板
├── docs/                        # 项目文档
└── infra/                       # 部署配置
```

---

## 📚 核心功能模块

## 3. 统一学生管理模块 (students_grades)

### 3.1 模块概述
统一学生管理模块（`students_grades`）是系统的核心，整合了学生档案管理、考试管理、成绩录入与分析等所有与学生相关的功能。该模块为合并后的模块，包含原先的 `students` 与 `exams` 功能，提供从入学到毕业的全生命周期管理体验，实现学生信息与学业表现的一体化管理。

### 3.2 子功能模块

#### 3.2.1 学生档案管理
**功能描述**: 完整的学生基础信息和学籍状态管理系统。

**主要特性**:
- **基础信息管理**: 学号、姓名、性别、出生日期等
- **学籍管理**: 年级、班级、入学日期、毕业日期
- **联系信息**: 家庭地址、监护人姓名、联系电话
- **身份验证**: 身份证号码（带格式验证）、学籍号
- **状态管理**: 在读、转学、休学、复学、毕业

**数据模型**:
```python
Student Model (15个字段)
├── student_id              # 学号 (唯一)
├── name                    # 姓名
├── gender                  # 性别 (男/女)
├── date_of_birth          # 出生日期
├── grade_level            # 年级 (初一-初三, 高一-高三)
├── current_class          # 当前班级 (外键)
├── status                 # 在校状态
├── id_card_number         # 身份证号 (带验证)
├── student_enrollment_number # 学籍号
├── home_address           # 家庭地址
├── guardian_name          # 监护人姓名
├── guardian_contact_phone # 监护人联系电话 (带验证)
├── entry_date             # 入学日期
├── graduation_date        # 毕业日期
└── id                     # 系统主键

Class Model (班级管理)
├── grade_level            # 年级
├── class_name             # 班级名称
└── homeroom_teacher       # 班主任 (外键到User)
```

#### 3.2.2 考试管理子系统
**功能描述**: 完整的考试生命周期管理，从考试创建到成绩分析的全流程支持。

**主要特性**:
- **两步式考试创建**: 
  - 步骤1: 基础信息（考试名称、学年、日期、年级、描述）
  - 步骤2: 科目配置（科目选择、满分设置）
- **智能科目配置**: 根据年级自动推荐默认科目和满分
- **灵活满分设置**: 支持不同年级不同科目的差异化满分配置
- **考试编辑**: 支持考试信息的后续修改和更新

**数据模型**:
```python
Exam Model (考试基础信息)
├── name                    # 考试名称
├── academic_year          # 学年 (如"2024-2025")
├── date                   # 考试日期
├── grade_level           # 适用年级
└── description           # 考试描述

ExamSubject Model (考试科目配置)
├── exam                  # 关联考试 (外键)
├── subject_code         # 科目代码
├── subject_name         # 科目名称
└── max_score           # 该科目满分

Subject Model (科目管理)
├── name                 # 科目名称
└── description          # 科目描述
```

#### 3.2.3 学业成绩管理子系统
**功能描述**: 学生学业表现的全方位记录、分析和管理系统。

**主要特性**:
- **多种录入方式**: 
  - 单个成绩录入
  - 批量Excel导入
  - AJAX异步批量录入
- **智能验证**: 成绩范围验证、重复检查
- **实时排名**: 异步计算年级排名和学科排名
- **批量操作**: 导出、删除、编辑的批量处理

**数据模型**:
```python
Score Model (成绩记录)
├── student              # 学生 (外键)
├── exam                # 考试 (外键)  
├── subject             # 科目 (外键)
├── score_value         # 得分
├── grade_rank_in_subject    # 学科年级排名
├── total_score_rank_in_grade # 总分年级排名
└── recorded_at         # 记录时间
```

#### 3.2.4 学业查询子系统
**功能描述**: 强大的多维度学生信息和成绩查询检索系统。

**查询维度**:
- **学生档案查询**: 按姓名、学号、班级等维度查询学生信息
- **学业表现查询**: 按学生查询历次考试成绩和趋势
- **班级群体查询**: 按班级查询集体学业表现
- **考试成绩查询**: 按考试查询全体学生成绩分布
- **科目分析查询**: 按科目查询成绩分布和难度分析
- **时间维度查询**: 按学年、学期查询成绩和档案变化

**功能特性**:
- **统一查询入口**: 学生档案和成绩的一体化查询界面
- **高级筛选**: 支持多条件组合查询
- **实时搜索**: AJAX实时学生姓名搜索
- **数据导出**: 查询结果Excel导出
- **冻结列表格**: 优化的表格显示，支持列冻结

#### 3.2.5 学业分析子系统
**功能描述**: 全方位的学生学业数据分析和可视化报表系统，提供多维度、多层次的学业数据洞察。

**分析维度**:

**A. 学生个人成绩分析** (`/analysis/student/detail/`)
> 🔥 **核心功能** - 提供最全面的学生个人学业分析体验

**基础信息展示**:
- **学生档案**: 学号、姓名、年级、班级等基础信息
- **考试参与情况**: 参加的所有考试列表和考试统计

**多维度筛选分析**:
- **🎯 考试多选**: 支持选择单个或多个考试进行对比分析
- **📚 科目多选**: 支持总分及各单科成绩的灵活组合分析  
- **📊 排名类型**: 支持班级排名和年级排名的切换对比
- **🔄 默认智能选择**: 自动选择所有考试、总分、年级排名作为初始分析

**可视化图表**:
- **📈 排名趋势图**: 
  - 支持多考试、多科目的排名变化趋势
  - 智能横坐标间距调整，优化2-3个考试的显示效果
  - 统一显示格式：学年+考试名（年级）
  - 动态边距调整，让数据点分布更合理
- **🎯 雷达图分析**: 单次考试的各科目成绩雷达图对比
- **📊 成绩对比柱状图**: 不同考试间的成绩对比分析

**详细数据表格**:
- **📋 成绩明细**: 按最新考试排序的详细成绩表格
- **🎨 各科详情**: 科目：得分（级排：年级排名，班排：班级排名）格式
- **📱 响应式设计**: 支持横向滚动，无冻结列，适配各种屏幕
- **📊 统计汇总**: 总分、平均分、排名等关键指标

**技术特性**:
- **⚡ 异步加载**: AJAX动态数据加载，无需页面刷新
- **🔄 实时更新**: 筛选条件变化时图表和表格实时更新  
- **💫 动画效果**: 平滑的图表过渡和交互动画
- **📱 响应式**: 完美适配PC、平板、手机等各种设备
- **⚠️ 错误处理**: 完善的错误提示和异常处理机制

**B. 班级群体成绩分析** (`/analysis/class/`)
> 📊 **班级视角** - 从班级维度进行群体学业表现分析

**班级概况统计**:
- **基础信息**: 班级人数、男女比例、平均年龄
- **学业概览**: 班级总体成绩水平、年级排名位置
- **参与度统计**: 各次考试的参与人数和参与率

**群体表现分析**:
- **📈 班级趋势**: 班级整体成绩在年级中的排名变化
- **📊 科目对比**: 班级各科目相对于年级平均水平的表现
- **🎯 优势分析**: 班级优势科目和薄弱环节识别
- **👥 学生分布**: 不同成绩区间的学生分布情况

**可视化展示**:
- **雷达图**: 班级各科目成绩与年级平均的对比
- **柱状图**: 班级历次考试成绩趋势
- **分布图**: 班级成绩分布与年级分布的对比
- **排名图**: 班级在年级中的排名变化趋势

**C. 年级整体成绩分析** (`/analysis/grade/`)
> 🏫 **年级视角** - 宏观的年级整体学业数据分析

**年级概况统计**:
- **基础数据**: 年级总人数、班级数量、性别分布
- **考试参与**: 各次考试的整体参与情况统计
- **成绩分布**: 年级成绩的整体分布特征

**深度对比分析**:
- **📊 班级对比**: 各班级间的成绩对比和排名
- **📈 科目分析**: 各科目的难度系数和区分度分析
- **🎯 趋势识别**: 年级整体学业水平的变化趋势
- **⭐ 优秀率统计**: 各分数段学生比例和优秀率变化

**高级可视化**:
- **热力图**: 科目难度和班级表现的二维热力图
- **箱线图**: 年级成绩分布的统计特征展示
- **对比图**: 多班级多科目的综合对比分析
- **趋势图**: 年级整体学业水平的时间序列分析

**特色功能**:
- **🔒 冻结表格**: 支持大量数据的高效浏览体验
- **📱 响应式设计**: 完美适配各种屏幕尺寸
- **📊 数据导出**: 支持分析结果的Excel导出
- **🔍 深度筛选**: 多维度条件筛选和数据钻取

### 3.3 批量操作功能
**功能描述**: 高效的批量数据处理能力，覆盖学生档案和成绩管理的各个方面。

**学生档案批量操作**:
- **📥 批量导入**: Excel文件导入学生信息
- **🗑️ 批量删除**: 多选删除学生记录
- **📝 批量状态更新**: 批量修改学生在校状态
- **🎓 批量升年级**: 一键处理年级升级
- **👨‍🎓 批量毕业**: 批量设置学生毕业状态

**学业成绩批量操作**:
- **📥 批量成绩导入**: Excel文件批量导入考试成绩
- **📊 批量成绩导出**: 按条件导出成绩数据
- **🗑️ 批量成绩删除**: 多选删除成绩记录
- **✏️ 批量成绩编辑**: 批量修改成绩数据
- **📄 模板下载**: 提供标准Excel导入模板

### 3.4 技术特性

#### 3.4.1 异步任务处理
**功能描述**: 利用django-rq实现大数据量的异步处理。

**应用场景**:
- **排名计算**: 大规模学生成绩排名异步计算
- **批量导入**: 大量学生档案和成绩数据的后台处理
- **报表生成**: 复杂统计报表的异步生成
- **数据迁移**: 学生升年级等批量操作的异步处理

#### 3.4.2 一体化数据管理
**功能描述**: 学生档案与学业数据的统一管理和关联分析。

**核心特性**:
- **数据关联**: 学生档案与成绩数据的无缝关联
- **状态同步**: 学生状态变化与成绩记录的自动同步
- **历史追踪**: 完整的学生学业历程追踪
- **数据一致性**: 确保档案与成绩数据的一致性

### 3.5 成绩分析系统核心特色

#### 3.5.1 智能分析引擎
**多维度数据处理**:
- **🧠 智能排名计算**: 自动计算班级排名、年级排名、科目排名
- **📊 趋势识别**: 基于历史数据的成绩趋势分析和预测
- **🎯 异常检测**: 自动识别成绩异常波动和特殊表现
- **📈 对比分析**: 横向对比（同班、同年级）和纵向对比（历史表现）

#### 3.5.2 可视化技术栈
**Chart.js 图表库集成**:
- **📈 趋势图**: 支持多数据集的线性图表，动态边距调整
- **🎯 雷达图**: 多维数据的雷达图展示，支持多层对比
- **📊 柱状图**: 成绩对比的柱状图，支持分组和堆叠
- **📱 响应式**: 所有图表完美适配移动端设备

#### 3.5.3 交互体验优化
**前端交互技术**:
- **⚡ AJAX异步**: 无刷新的数据加载和图表更新
- **🔄 实时筛选**: 筛选条件变化时的实时图表重绘
- **💫 动画效果**: 平滑的图表过渡和数据变化动画
- **🎨 主题配色**: 统一的色彩体系和视觉规范

### 3.6 页面功能总览
```
统一学生管理入口:
├── /students/                     # 学生管理主页（整合档案和成绩）

学生档案管理:
├── /students/profile/             # 学生档案列表
├── /students/profile/add/         # 新增学生档案
├── /students/profile/<id>/edit/   # 编辑学生档案  
├── /students/profile/batch/       # 批量档案操作

考试管理:
├── /students/exams/               # 考试列表
├── /students/exams/create/step1/  # 考试创建-基础信息
├── /students/exams/create/step2/  # 考试创建-科目配置
├── /students/exams/<id>/edit/     # 考试编辑

成绩管理:
├── /students/scores/              # 成绩列表
├── /students/scores/add/          # 单个成绩录入
├── /students/scores/batch/        # 批量成绩操作

学业查询:
├── /students/query/               # 统一查询界面
├── /students/query/results/       # 查询结果展示
├── /students/query/export/        # 数据导出

🔥 核心成绩分析系统:
├── /analysis/                     # 成绩分析主页
├── /analysis/student/             # 学生个人分析选择页
├── /analysis/student/detail/      # 🌟 学生个人成绩详细分析（核心功能）
├── /analysis/class/               # 班级群体成绩分析
├── /analysis/grade/               # 年级整体成绩分析
└── /analysis/export/              # 分析结果导出

🔧 AJAX API接口:
├── /get_student_analysis_data/    # 学生个人分析数据API
├── /get_class_analysis_data/      # 班级分析数据API
├── /get_grade_analysis_data/      # 年级分析数据API
└── /export_analysis_report/       # 分析报告导出API
```

## 4. 前端应用模块 (frontend)

### 4.1 技术栈
基于现代化的React生态系统构建，提供优秀的用户体验。

**核心技术**:
- **Next.js 15.4.6**: App Router、服务端渲染、API路由
- **React 19**: 最新的React特性和性能优化
- **TypeScript**: 类型安全的开发体验
- **Tailwind CSS**: 原子化CSS和响应式设计
- **Radix UI**: 高质量的UI组件库

### 4.2 主要功能
- **用户注册登录**: 完整的身份认证流程
- **学生管理界面**: 与统一学生模块的无缝集成
- **响应式界面**: 支持PC、平板、手机多端访问
- **现代化UI**: 基于设计系统的一致性界面
- **API集成**: 与Django后端的无缝集成

### 4.3 开发特性
- **热重载**: 快速的开发调试体验
- **TypeScript**: 类型安全和代码智能提示
- **ESLint**: 代码质量检查和规范
- **组件化**: 可复用的UI组件系统

---

## 5. 系统管理模块

### 5.1 运维脚本 (scripts/)
**功能描述**: 完整的系统运维和监控工具集。

**脚本清单**:
- **monitor_tasks.py**: RQ任务队列监控
- **django_status.py**: Django系统状态检查
- **manage_admin_users.py**: 管理员用户管理
- **start_sms.sh**: 一键启动系统服务

注意：项目结构已将历史上的 `students` 和 `exams` 应用合并到 `school_management/students_grades/`，并移除了旧的 `school_management/students/` 与 `school_management/exams/` 目录。相关运维脚本（如 `scripts/django_status.py`、`scripts/monitor_tasks.py`）已更新为从 `school_management.students_grades` 引入模型和函数。

如果你的部署或外部任务（Cron、CI/CD、运维脚本）仍然引用旧模块路径，请将导入更新为 `school_management.students_grades` 或联系维护人员进行同步更新。

### 5.2 数据管理 (data/)
**功能描述**: 数据文件和模板管理。

**内容包括**:
- **导入模板**: 学生信息、成绩数据Excel模板
- **样例数据**: 测试和演示用数据
- **数据备份**: 重要数据的备份文件

### 5.3 异步任务系统
**功能描述**: 基于Redis和django-rq的异步任务处理。

**核心功能**:
- **任务队列**: 支持default、high、low优先级队列
- **任务监控**: 实时监控任务执行状态
- **失败重试**: 自动重试和错误恢复机制
- **性能监控**: 任务执行统计和性能分析

---

## 🚀 部署和运行

### 6.1 快速启动
```bash
# 1. 环境准备
conda activate sms
pip install -r requirements.txt

# 2. 数据库初始化
python manage.py makemigrations
python manage.py migrate

# 3. 启动系统 (一键启动)
bash start_sms.sh
```

### 6.2 服务访问
- **主系统**: http://127.0.0.1:8001
- **管理后台**: http://127.0.0.1:8001/admin/
- **任务监控**: http://127.0.0.1:8001/django-rq/
- **前端应用**: http://127.0.0.1:3000 (开发模式)

### 6.3 系统要求
- **Python**: 3.12+
- **Node.js**: 18+
- **Redis**: 用于异步任务队列
- **浏览器**: Chrome/Firefox/Safari/Edge (现代浏览器)

---

## 📊 数据统计

### 7.1 系统规模
- **代码行数**: ~10,000+ 行
- **数据模型**: 6个核心模型（整合在统一学生模块中）
- **API接口**: 30+ 个功能接口
- **页面模板**: 25+ 个功能页面
- **前端组件**: 20+ 个React组件

### 7.2 功能统计
- **学生档案管理**: 15个字段的完整学生档案
- **考试成绩管理**: 支持10个科目的成绩管理
- **批量操作**: 10种批量操作功能（档案+成绩）
- **🔥 成绩分析系统**: 
  - **3个分析维度**: 学生个人、班级群体、年级整体
  - **4种图表类型**: 趋势图、雷达图、柱状图、数据表格
  - **多维筛选**: 考试多选、科目多选、排名类型切换
  - **智能默认**: 自动选择最优分析配置
  - **响应式图表**: 完美适配各种设备屏幕
- **异步任务**: 3个优先级队列
- **前端技术**: Chart.js图表库 + Bootstrap响应式框架

---

## 🔄 未来规划

### 8.1 短期计划 (V2.0)
- [ ] **🎨 成绩分析UI升级**: 
  - [ ] 更多图表类型（散点图、热力图、3D图表）
  - [ ] 图表联动和钻取功能
  - [ ] 自定义图表配色和主题
  - [ ] 图表数据导出（PNG、PDF、Excel）
- [ ] **📊 智能分析增强**:
  - [ ] 成绩预测和趋势预警
  - [ ] 学习建议和改进方案推荐
  - [ ] 同类学生对比分析
  - [ ] 科目关联性分析
- [ ] **统一界面优化**: 完善学生模块的一体化用户界面
- [ ] **移动端适配**: 完整的移动端应用和图表适配
- [ ] **权限系统完善**: 细粒度的角色权限管理
- [ ] **API文档**: 完整的RESTful API文档

### 8.2 中期计划 (V3.0)
- [ ] **🤖 AI智能分析**:
  - [ ] 基于机器学习的成绩预测模型
  - [ ] 学习路径推荐和个性化建议
  - [ ] 智能识别学习问题和解决方案
  - [ ] 学生潜力评估和发展建议
- [ ] **📱 移动端完整支持**:
  - [ ] 微信小程序版本
  - [ ] 移动端原生应用
  - [ ] 家长端独立应用
- [ ] **🌐 多租户架构**:
  - [ ] 支持多个学校的SaaS模式
  - [ ] 跨校数据对比和基准分析
  - [ ] 区域教育数据统计
- [ ] **🎯 学业生涯规划**: 基于学业数据的升学指导

### 8.3 长期愿景
- [ ] **教育大数据**: 区域教育数据分析平台
- [ ] **智能推荐**: 个性化学习建议系统
- [ ] **云端部署**: 完整的云原生架构
- [ ] **学业档案区块链**: 不可篡改的学业成就记录

---

## 👥 贡献指南

### 9.1 开发规范
- **代码风格**: 遵循PEP 8 (Python) 和ESLint (JavaScript/TypeScript)
- **提交规范**: 使用语义化提交信息
- **分支管理**: Git Flow 工作流
- **测试要求**: 单元测试覆盖率 > 80%

### 9.2 参与方式
1. Fork 项目仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📝 更新日志

### v1.0.0 (当前版本)
- ✅ 统一学生管理系统（整合档案、考试、成绩管理）
- ✅ 🔥 **完善的成绩分析系统**:
  - ✅ 学生个人成绩详细分析（多考试、多科目、多排名类型）
  - ✅ 智能趋势图（动态间距调整、统一标签格式）
  - ✅ 交互式雷达图和柱状图
  - ✅ 响应式数据表格（横向滚动、格式化显示）
  - ✅ 实时筛选和AJAX异步加载
- ✅ 多维度学业数据分析（个人/班级/年级）
- ✅ 全方位批量操作功能
- ✅ 异步任务处理
- ✅ 响应式前端界面
- ✅ 一体化查询系统
- ✅ 系统监控工具
- ✅ 完善的错误处理和用户体验优化

---

## 📞 联系我们

**项目维护者**: SMS开发团队  
**技术支持**: 通过GitHub Issues  
**文档更新**: 2025年9月3日

---

**🎯 SMS学校成绩管理系统 - 以学生为中心的一体化教育数据管理平台**
