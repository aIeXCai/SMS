# 学校成绩管理系统 (SMS)
> School Management System - 产品需求文档 (PRD)

## 📋 项目概览

### 1.1 产品定位
学校成绩管理系统是一个面向中小学的综合性学生管理平台，以学生为中心整合学籍管理、考试管理、成绩录入与分析等核心教务功能。系统采用现代化的Web技术栈，提供学生全生命周期的一体化管理体验，支持多角色用户访问，提供直观的数据可视化和强大的数据分析能力。

### 1.2 技术架构
- **后端**: Django 5.2.4 + Python 3.12+
- **前端**: Next.js 15.4.6 + React 19 + TypeScript + Tailwind CSS
- **数据库**: SQLite (开发环境) / PostgreSQL (生产环境)
- **异步任务**: Redis + django-rq
- **部署**: 支持 Docker 容器化部署

### 1.3 核心价值
- 📊 **以学生为中心**: 提供学生全生命周期的一体化管理体验
- 🎯 **数据驱动决策**: 全方位的学业表现统计分析和可视化报表
- 🚀 **高效教务管理**: 支持批量操作，大幅提升教务管理效率
- 🔒 **安全可靠**: 完善的权限控制和数据安全保障
- 📱 **响应式设计**: 支持PC、平板、手机多端访问

---

## 🏗️ 系统架构

### 2.1 技术栈详情
```
Frontend Layer (前端层)
├── Next.js 15.4.6 (App Router)
├── React 19 + TypeScript
├── Tailwind CSS + Radix UI
└── 响应式UI组件库

Backend Layer (后端层)
├── Django 5.2.4 (Python 3.12+)
├── Django REST Framework (API)
├── django-rq (异步任务处理)
└── 权限认证系统

Data Layer (数据层)
├── SQLite/PostgreSQL (主数据库)
├── Redis (缓存 + 任务队列)
└── 数据迁移和备份系统

Infrastructure (基础设施)
├── Docker 容器化
├── Nginx 反向代理
└── 日志监控系统
```

### 2.2 项目结构
```
SMS/
├── school_management/           # Django 后端应用
│   ├── students_grades/         # 统一学生/考试/成绩模块（原 students + exams 已合并）
│   │   ├── models/              # 数据模型（Student, Exam, Score 等）
│   │   ├── views/               # 视图/分析逻辑（成绩分析、排名计算等）
│   │   ├── urls.py              # 应用路由
│   │   └── admin.py             # 后台管理配置
│   └── settings.py              # 系统配置
├── frontend/                    # Next.js 前端应用
├── templates/                   # Django 模板
├── scripts/                     # 运维脚本（已更新为引用 students_grades）
├── data/                        # 数据文件和模板
├── docs/                        # 项目文档
└── infra/                       # 部署配置
```

---

## 📚 核心功能模块

## 3. 统一学生管理模块 (students_grades)

### 3.1 模块概述
统一学生管理模块（`students_grades`）是系统的核心，整合了学生档案管理、考试管理、成绩录入与分析等所有与学生相关的功能。该模块为合并后的模块，包含原先的 `students` 与 `exams` 功能，提供从入学到毕业的全生命周期管理体验，实现学生信息与学业表现的一体化管理。

### 3.2 子功能模块

#### 3.2.1 学生档案管理
**功能描述**: 完整的学生基础信息和学籍状态管理系统。

**主要特性**:
- **基础信息管理**: 学号、姓名、性别、出生日期等
- **学籍管理**: 年级、班级、入学日期、毕业日期
- **联系信息**: 家庭地址、监护人姓名、联系电话
- **身份验证**: 身份证号码（带格式验证）、学籍号
- **状态管理**: 在读、转学、休学、复学、毕业

**数据模型**:
```python
Student Model (15个字段)
├── student_id              # 学号 (唯一)
├── name                    # 姓名
├── gender                  # 性别 (男/女)
├── date_of_birth          # 出生日期
├── grade_level            # 年级 (初一-初三, 高一-高三)
├── current_class          # 当前班级 (外键)
├── status                 # 在校状态
├── id_card_number         # 身份证号 (带验证)
├── student_enrollment_number # 学籍号
├── home_address           # 家庭地址
├── guardian_name          # 监护人姓名
├── guardian_contact_phone # 监护人联系电话 (带验证)
├── entry_date             # 入学日期
├── graduation_date        # 毕业日期
└── id                     # 系统主键

Class Model (班级管理)
├── grade_level            # 年级
├── class_name             # 班级名称
└── homeroom_teacher       # 班主任 (外键到User)
```

#### 3.2.2 考试管理子系统
**功能描述**: 完整的考试生命周期管理，从考试创建到成绩分析的全流程支持。

**主要特性**:
- **两步式考试创建**: 
  - 步骤1: 基础信息（考试名称、学年、日期、年级、描述）
  - 步骤2: 科目配置（科目选择、满分设置）
- **智能科目配置**: 根据年级自动推荐默认科目和满分
- **灵活满分设置**: 支持不同年级不同科目的差异化满分配置
- **考试编辑**: 支持考试信息的后续修改和更新

**数据模型**:
```python
Exam Model (考试基础信息)
├── name                    # 考试名称
├── academic_year          # 学年 (如"2024-2025")
├── date                   # 考试日期
├── grade_level           # 适用年级
└── description           # 考试描述

ExamSubject Model (考试科目配置)
├── exam                  # 关联考试 (外键)
├── subject_code         # 科目代码
├── subject_name         # 科目名称
└── max_score           # 该科目满分

Subject Model (科目管理)
├── name                 # 科目名称
└── description          # 科目描述
```

#### 3.2.3 学业成绩管理子系统
**功能描述**: 学生学业表现的全方位记录、分析和管理系统。

**主要特性**:
- **多种录入方式**: 
  - 单个成绩录入
  - 批量Excel导入
  - AJAX异步批量录入
- **智能验证**: 成绩范围验证、重复检查
- **实时排名**: 异步计算年级排名和学科排名
- **批量操作**: 导出、删除、编辑的批量处理

**数据模型**:
```python
Score Model (成绩记录)
├── student              # 学生 (外键)
├── exam                # 考试 (外键)  
├── subject             # 科目 (外键)
├── score_value         # 得分
├── grade_rank_in_subject    # 学科年级排名
├── total_score_rank_in_grade # 总分年级排名
└── recorded_at         # 记录时间
```

#### 3.2.4 学业查询子系统
**功能描述**: 强大的多维度学生信息和成绩查询检索系统。

**查询维度**:
- **学生档案查询**: 按姓名、学号、班级等维度查询学生信息
- **学业表现查询**: 按学生查询历次考试成绩和趋势
- **班级群体查询**: 按班级查询集体学业表现
- **考试成绩查询**: 按考试查询全体学生成绩分布
- **科目分析查询**: 按科目查询成绩分布和难度分析
- **时间维度查询**: 按学年、学期查询成绩和档案变化

**功能特性**:
- **统一查询入口**: 学生档案和成绩的一体化查询界面
- **高级筛选**: 支持多条件组合查询
- **实时搜索**: AJAX实时学生姓名搜索
- **数据导出**: 查询结果Excel导出
- **冻结列表格**: 优化的表格显示，支持列冻结

#### 3.2.5 学业分析子系统
**功能描述**: 全方位的学生学业数据分析和可视化报表系统。

**分析维度**:

**A. 学生个人学业分析** (`/students/analysis/individual/`)
- **档案信息**: 基础信息、学籍变化历史
- **学业表现**: 个人各科成绩变化趋势、年级排名变化
- **强弱科分析**: 优势科目和薄弱环节识别
- **可视化**: 
  - 个人成绩折线图
  - 排名变化趋势图
  - 雷达图对比分析

**B. 班级群体学业分析** (`/students/analysis/class/`)
- **班级档案**: 班级基本信息、人数构成
- **学业统计**: 班级各科平均分、最高分、最低分
- **排名分布**: 班级总分分布和年级排名
- **可视化**: 
  - 各科成绩对比雷达图
  - 成绩分布直方图
  - 班级排名趋势图

**C. 年级整体学业分析** (`/students/analysis/grade/`)
- **年级概况**: 年级人数、班级分布
- **学业分布**: 年级整体成绩分布和各班级对比
- **科目分析**: 各科目难度系数和成绩分布
- **可视化**:
  - 年级成绩分布箱线图
  - 班级对比柱状图
  - 科目难度热力图
- **特色功能**:
  - 冻结列表格显示（支持大量班级数据的高效浏览）
  - 响应式设计，支持全屏显示

### 3.3 批量操作功能
**功能描述**: 高效的批量数据处理能力，覆盖学生档案和成绩管理的各个方面。

**学生档案批量操作**:
- **📥 批量导入**: Excel文件导入学生信息
- **🗑️ 批量删除**: 多选删除学生记录
- **📝 批量状态更新**: 批量修改学生在校状态
- **🎓 批量升年级**: 一键处理年级升级
- **👨‍🎓 批量毕业**: 批量设置学生毕业状态

**学业成绩批量操作**:
- **📥 批量成绩导入**: Excel文件批量导入考试成绩
- **📊 批量成绩导出**: 按条件导出成绩数据
- **🗑️ 批量成绩删除**: 多选删除成绩记录
- **✏️ 批量成绩编辑**: 批量修改成绩数据
- **📄 模板下载**: 提供标准Excel导入模板

### 3.4 技术特性

#### 3.4.1 异步任务处理
**功能描述**: 利用django-rq实现大数据量的异步处理。

**应用场景**:
- **排名计算**: 大规模学生成绩排名异步计算
- **批量导入**: 大量学生档案和成绩数据的后台处理
- **报表生成**: 复杂统计报表的异步生成
- **数据迁移**: 学生升年级等批量操作的异步处理

#### 3.4.2 一体化数据管理
**功能描述**: 学生档案与学业数据的统一管理和关联分析。

**核心特性**:
- **数据关联**: 学生档案与成绩数据的无缝关联
- **状态同步**: 学生状态变化与成绩记录的自动同步
- **历史追踪**: 完整的学生学业历程追踪
- **数据一致性**: 确保档案与成绩数据的一致性

### 3.5 页面功能总览
```
统一学生管理入口:
├── /students/                     # 学生管理主页（整合档案和成绩）

学生档案管理:
├── /students/profile/             # 学生档案列表
├── /students/profile/add/         # 新增学生档案
├── /students/profile/<id>/edit/   # 编辑学生档案
├── /students/profile/batch/       # 批量档案操作

考试管理:
├── /students/exams/               # 考试列表
├── /students/exams/create/step1/  # 考试创建-基础信息
├── /students/exams/create/step2/  # 考试创建-科目配置
├── /students/exams/<id>/edit/     # 考试编辑

成绩管理:
├── /students/scores/              # 成绩列表
├── /students/scores/add/          # 单个成绩录入
├── /students/scores/batch/        # 批量成绩操作

学业查询:
├── /students/query/               # 统一查询界面
├── /students/query/results/       # 查询结果展示
├── /students/query/export/        # 数据导出

学业分析:
├── /students/analysis/            # 分析首页
├── /students/analysis/individual/ # 学生个人分析
├── /students/analysis/class/      # 班级群体分析
└── /students/analysis/grade/      # 年级整体分析
```

## 4. 前端应用模块 (frontend)

### 4.1 技术栈
基于现代化的React生态系统构建，提供优秀的用户体验。

**核心技术**:
- **Next.js 15.4.6**: App Router、服务端渲染、API路由
- **React 19**: 最新的React特性和性能优化
- **TypeScript**: 类型安全的开发体验
- **Tailwind CSS**: 原子化CSS和响应式设计
- **Radix UI**: 高质量的UI组件库

### 4.2 主要功能
- **用户注册登录**: 完整的身份认证流程
- **学生管理界面**: 与统一学生模块的无缝集成
- **响应式界面**: 支持PC、平板、手机多端访问
- **现代化UI**: 基于设计系统的一致性界面
- **API集成**: 与Django后端的无缝集成

### 4.3 开发特性
- **热重载**: 快速的开发调试体验
- **TypeScript**: 类型安全和代码智能提示
- **ESLint**: 代码质量检查和规范
- **组件化**: 可复用的UI组件系统

---

## 5. 系统管理模块

### 5.1 运维脚本 (scripts/)
**功能描述**: 完整的系统运维和监控工具集。

**脚本清单**:
- **monitor_tasks.py**: RQ任务队列监控
- **django_status.py**: Django系统状态检查
- **manage_admin_users.py**: 管理员用户管理
- **start_sms.sh**: 一键启动系统服务

注意：项目结构已将历史上的 `students` 和 `exams` 应用合并到 `school_management/students_grades/`，并移除了旧的 `school_management/students/` 与 `school_management/exams/` 目录。相关运维脚本（如 `scripts/django_status.py`、`scripts/monitor_tasks.py`）已更新为从 `school_management.students_grades` 引入模型和函数。

如果你的部署或外部任务（Cron、CI/CD、运维脚本）仍然引用旧模块路径，请将导入更新为 `school_management.students_grades` 或联系维护人员进行同步更新。

### 5.2 数据管理 (data/)
**功能描述**: 数据文件和模板管理。

**内容包括**:
- **导入模板**: 学生信息、成绩数据Excel模板
- **样例数据**: 测试和演示用数据
- **数据备份**: 重要数据的备份文件

### 5.3 异步任务系统
**功能描述**: 基于Redis和django-rq的异步任务处理。

**核心功能**:
- **任务队列**: 支持default、high、low优先级队列
- **任务监控**: 实时监控任务执行状态
- **失败重试**: 自动重试和错误恢复机制
- **性能监控**: 任务执行统计和性能分析

---

## 🚀 部署和运行

### 6.1 快速启动
```bash
# 1. 环境准备
conda activate sms
pip install -r requirements.txt

# 2. 数据库初始化
python manage.py makemigrations
python manage.py migrate

# 3. 启动系统 (一键启动)
bash start_sms.sh
```

### 6.2 服务访问
- **主系统**: http://127.0.0.1:8001
- **管理后台**: http://127.0.0.1:8001/admin/
- **任务监控**: http://127.0.0.1:8001/django-rq/
- **前端应用**: http://127.0.0.1:3000 (开发模式)

### 6.3 系统要求
- **Python**: 3.12+
- **Node.js**: 18+
- **Redis**: 用于异步任务队列
- **浏览器**: Chrome/Firefox/Safari/Edge (现代浏览器)

---

## 📊 数据统计

### 7.1 系统规模
- **代码行数**: ~10,000+ 行
- **数据模型**: 6个核心模型（整合在统一学生模块中）
- **API接口**: 30+ 个功能接口
- **页面模板**: 25+ 个功能页面
- **前端组件**: 20+ 个React组件

### 7.2 功能统计
- **学生档案管理**: 15个字段的完整学生档案
- **考试成绩管理**: 支持10个科目的成绩管理
- **批量操作**: 10种批量操作功能（档案+成绩）
- **学业分析**: 3个维度的深度分析（个人/班级/年级）
- **异步任务**: 3个优先级队列

---

## 🔄 未来规划

### 8.1 短期计划 (V2.0)
- [ ] **统一界面优化**: 完善学生模块的一体化用户界面
- [ ] **移动端适配**: 完整的移动端应用
- [ ] **学业数据可视化增强**: 更多图表类型和交互分析
- [ ] **权限系统完善**: 细粒度的角色权限管理
- [ ] **API文档**: 完整的RESTful API文档

### 8.2 中期计划 (V3.0)
- [ ] **微信小程序**: 移动端原生应用
- [ ] **智能学业分析**: AI驱动的学业表现趋势预测
- [ ] **家长端**: 家长查看学生档案和成绩的独立端口
- [ ] **多租户支持**: 支持多个学校的SaaS模式
- [ ] **学业生涯规划**: 基于学业数据的升学指导

### 8.3 长期愿景
- [ ] **教育大数据**: 区域教育数据分析平台
- [ ] **智能推荐**: 个性化学习建议系统
- [ ] **云端部署**: 完整的云原生架构
- [ ] **学业档案区块链**: 不可篡改的学业成就记录

---

## 👥 贡献指南

### 9.1 开发规范
- **代码风格**: 遵循PEP 8 (Python) 和ESLint (JavaScript/TypeScript)
- **提交规范**: 使用语义化提交信息
- **分支管理**: Git Flow 工作流
- **测试要求**: 单元测试覆盖率 > 80%

### 9.2 参与方式
1. Fork 项目仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📝 更新日志

### v1.0.0 (当前版本)
- ✅ 统一学生管理系统（整合档案、考试、成绩管理）
- ✅ 多维度学业数据分析（个人/班级/年级）
- ✅ 全方位批量操作功能
- ✅ 异步任务处理
- ✅ 响应式前端界面
- ✅ 一体化查询系统
- ✅ 系统监控工具

---

## 📞 联系我们

**项目维护者**: SMS开发团队  
**技术支持**: 通过GitHub Issues  
**文档更新**: 2025年9月3日

---

**🎯 SMS学校成绩管理系统 - 以学生为中心的一体化教育数据管理平台**
